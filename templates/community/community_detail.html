{% extends 'base.html' %}

{% load static %}

{#타이틀 넣는 곳#}
{% block title %}
Detail
{% endblock %}

{# css 파일 넣는 곳#}
{% block css %}

{% endblock %}

{#자바스크립트 파일 넣는 곳#}
{% block js %}
<script type="text/javascript" src="{% static 'js/comment_update.js' %}"></script>
{% endblock %}

{#메인 컨텐츠 들어가는 곳#}
{% block content %}

    {% comment %} 임시 로그아웃 {% endcomment %}
    {% if not user.is_authenticated %}
    <span>Healthy 21</span>
    <i class="fa fa-search" style="font-size:36px"></i>
    {% else %}
    <a href="/logout">로그아웃</a>
    <br>
    {% endif %}

    {% comment %} 등록된 게시물 {% endcomment %}
    <span>{{ post.author.username }}</span>
    <p>{{ post.title }}</p>
    <span>{{ post.content }}</span>

    {% comment %} 태그 {% endcomment %}
    {% if post.tags.all %}
        {% for tag in post.tags.all %}
        <a href="{% url 'tagged_object_list' tag.name %}">
            <span> {{ tag.name }}</span>
        </a>
        {% endfor %}
        -<a style="text-decoration: none" href="{% url 'tag_cloud' %}">TagCloud</a>
    {% endif %}

    <form action="/community/comment/{{ post.id }}" method="POST">
        {% csrf_token %}
        <input type="text" id="comment" name="comment" placeholder="댓글">
        <button type="submit">댓글쓰기</button>
    </form>

    {% comment %} 게시물 수정 {% endcomment %}
    {% if post.author == user %}
        <a href="/community/post/update/{{ post.id }}"><i class="fa fa-edit" style="font-size:36px"></i></a>
    {% endif %}
    

    {% comment %} 게시물 댓글 {% endcomment %}
    {% for cm in comments %}
        <p>{{ cm.author }}</p>
        
        {% comment %} 댓글 수정 {% endcomment %}
        <form action="/community/comment/update/{{ cm.id }}" method="POST">
            {% csrf_token %}
                <textarea class="comment_content" name="comment_content" readOnly>{{ cm.comment }}</textarea>
            {% if cm.author == user %}
                <input class="comment_edit_{{ cm.id }}" type="button" onclick="editListener({{ cm.id }})" value="수정"></input>
            {% endif %}
        </form>

        {% comment %} 댓글 좋아요 {% endcomment %}
        <p>{{ cm.created_at | timesince }} 전</p>
        <a href="/community/comment/like/{{ cm.id }}">
            {% if user in cm.like.all %}
                <i class="fa fa-heart" style="font-size:36px;" id="heart"></i>
            {% else %}
                <i class="fa fa-heart-o" style="font-size:36px;" id="heart"></i>
            {% endif %}
                <span> {{ cm.like.count }} </span>
        </a>

        {% comment %} 댓글 삭제 {% endcomment %}
        {% if cm.author == user %}
            <a href="/community/comment/delete/{{ cm.id }}"><span>삭제</span></a>
        {% endif %}
    {% endfor %}


{% endblock %}

